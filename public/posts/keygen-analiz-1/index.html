<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Keygen Analizi - Bölüm 1 :: Doğu Us&#39; Blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Bir keygeni IDA Pro ve x64dbg ile analiz edip Rust ile baştan yazıyoruz - Bölüm 1" />
<meta name="keywords" content="blog, technology, programming" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://usdogu.github.io/posts/keygen-analiz-1/" />




<link rel="stylesheet" href="https://usdogu.github.io/assets/style.css">

  <link rel="stylesheet" href="https://usdogu.github.io/assets/red.css">






<link rel="apple-touch-icon" href="https://usdogu.github.io/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://usdogu.github.io/img/favicon/red.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Keygen Analizi - Bölüm 1">
<meta property="og:description" content="Bir keygeni IDA Pro ve x64dbg ile analiz edip Rust ile baştan yazıyoruz - Bölüm 1" />
<meta property="og:url" content="https://usdogu.github.io/posts/keygen-analiz-1/" />
<meta property="og:site_name" content="Doğu Us&#39; Blog" />

  
    <meta property="og:image" content="https://usdogu.github.io/img/favicon/red.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2022-09-11 00:00:00 &#43;0000 UTC" />












</head>
<body class="red">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    USPRO
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="https://usdogu.goatcounter.com/">Analytics</a></li>
        
      
        
          <li><a href="/index.xml">RSS</a></li>
        
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="https://usdogu.goatcounter.com/">Analytics</a></li>
      
    
      
        <li><a href="/index.xml">RSS</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://usdogu.github.io/posts/keygen-analiz-1/">Keygen Analizi - Bölüm 1</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-09-11
        
      </span>
    
    
      <span class="post-author">:: Doğu Us</span>
    
    
      <span class="post-reading-time">:: 3 min read (574 words)</span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://usdogu.github.io/tags/reversing/">reversing</a>&nbsp;
    
    #<a href="https://usdogu.github.io/tags/turkish/">turkish</a>&nbsp;
    
  </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Table of Contents
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#giriş">Giriş</a></li>
    <li><a href="#ilk-bakış">İlk Bakış</a></li>
    <li><a href="#sub_401000">sub_401000</a></li>
    <li><a href="#sub_4013d0">sub_4013D0</a></li>
    <li><a href="#sub_4013d0-dinamik-analiz">sub_4013D0 Dinamik Analiz</a></li>
    <li><a href="#while-döngüsü">While döngüsü</a></li>
    <li><a href="#sub_401420">sub_401420</a></li>
    <li><a href="#sub_401420-dinamik-analiz">sub_401420 Dinamik Analiz</a></li>
    <li><a href="#sub_401390">sub_401390</a></li>
    <li><a href="#sub_401390-dinamik-analiz">sub_401390 Dinamik Analiz</a></li>
    <li><a href="#sub_40123e">sub_40123E</a></li>
    <li><a href="#sub_4011c1">sub_4011C1</a></li>
    <li><a href="#sub_4012d4">sub_4012D4</a></li>
    <li><a href="#sondaki-küçük-kod-parçacığı">Sondaki Küçük Kod Parçacığı</a></li>
    <li><a href="#çıkış">Çıkış</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <h2 id="giriş">Giriş<a href="#giriş" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Http Debugger Pro kullanırken yenik düştüğüm merakım yüzünden bu gönderiyi yazıyorum</p>
<p>kendileri yaparak takip etmek isteyenler için:</p>
<p>Dosya: <a href="https://cloud.disroot.org/s/w33G9eCFne9NibH">https://cloud.disroot.org/s/w33G9eCFne9NibH</a></p>
<p>VT: <a href="https://www.virustotal.com/gui/file/2234957b4842355a4c3d1295dd9d89c9cb0949a15ad41ddee30cf93c62c8b0e2">https://www.virustotal.com/gui/file/2234957b4842355a4c3d1295dd9d89c9cb0949a15ad41ddee30cf93c62c8b0e2</a></p>
<h2 id="ilk-bakış">İlk Bakış<a href="#ilk-bakış" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Dosyayı IDA&rsquo;ya atıp start fonksiyonunu decompile edelim bakalım neler dönüyor..
<img src="images/ida_ilk_bakis.JPG" alt="IDA ilk bakış">
Diğerlerini bilmem ama sub_401000 kesinlikle kayıt defteri ile alakalı bişeyler yapıyor daha detaylı inceleyelim</p>
<h2 id="sub_401000">sub_401000<a href="#sub_401000" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_401000.JPG" alt="kayıt defteri okuyucu">
Tam da düşündüğüm gibi ilk verilen argümanı &ldquo;subkey&rdquo; ikinciyi değer adı olarak kullanarak uygulama versiyonunu üçüncü argümana yazıyor. Benim bu gönderiyi yazarken kullandığım sürümde yazan değer &ldquo;HTTP Debugger 9.0.0.12&rdquo; şeklinde, bakalım bu veri nasıl kullanılıcak. Fonksiyonu get_app_version, üçüncü argümanı app_version olarak yeniden adlandırıp devam ediyorum</p>
<h2 id="sub_4013d0">sub_4013D0<a href="#sub_4013d0" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_4013D0.JPG" alt="sub_4013D0">
Bu arkadaşımız bir sonraki çağrılan fonksiyon, uygulama versiyonunu ise argüman olarak alıyor. Buna bir süre boş boş baktıktan sonra bunu (şimdilik) statik olarak anlamaya çalışıcak kadar ruh hastası olmadığıma karar verdim x64dbg üzerinden devam ediyoruz :D</p>
<h2 id="sub_4013d0-dinamik-analiz">sub_4013D0 Dinamik Analiz<a href="#sub_4013d0-dinamik-analiz" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>
 
<video width=100% controls>
    <source src="images/sub_4013D0.mp4" type="video/mp4">
    Your browser does not support the video tag.  
</video>

Burdan anladığım kadarıyla uygulama versiyonunun son 2 sayısını döndürüyor ama içimde bişey kaçırıyormuşum gibi bir his var yine de devam edelim</p>
<h2 id="while-döngüsü">While döngüsü<a href="#while-döngüsü" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> ( <span style="color:#f92672">*</span>v4 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">32</span> )
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">*</span>v4 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">46</span> )
</span></span><span style="display:flex;"><span>      String[v5<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>v4;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--</span>v4;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>şeklinde bi döngümüz var, sıçtık galiba&hellip; Bir önceki fonksiyonun char* döndürdüğünü gördüğümde IDA yanlış decompile etmiştir diyip geçmiştim ama harbiden yazı döndürüyor gibi 32 ve 46 ASCII&rsquo;de  sırasıyla boşluğa ve nokta karakterine denk geliyor yani bi önceki fonksiyonun son 2 sayıyı değil &ldquo;HTTP Debugger&rdquo; kısmını silip sadece 9.0.0.12 döndürüyor olması çok kuvvetli ihtimal. Fonksiyonun 9.0.0.12 döndürdüğünü varsayıp devam edelim. Bu kod parçası nokta karakteri olmayan her karakteri String isimli bir değişkene koyuyor ve sonuç olarak 9.0.0.12 değeri 90012 oluyor, Bu değişkeni version_cleaned olarak yeniden adlandırıp devam ediyorum</p>
<p>Sonradan gelen not: Bu kod yanlış decompile edilmiş ++v4 olması gerekiyor assembly&rsquo;e göre.</p>
<p>Okuyucuya not: Kafanızı monitöre vurmadan önce decompilerlara güvenilmemesi gerektiğini öğrenin.</p>
<h2 id="sub_401420">sub_401420<a href="#sub_401420" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_401420.JPG" alt="sub_401420">
Hiçbir şey dememe gerek yok x64dbg üzerinden devam ediyoruz :D</p>
<h2 id="sub_401420-dinamik-analiz">sub_401420 Dinamik Analiz<a href="#sub_401420-dinamik-analiz" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>
 
<video width=100% controls>
    <source src="images/sub_401420.mp4" type="video/mp4">
    Your browser does not support the video tag.  
</video>

Bu kanser şeyin sırf benim gibilere vakit kaybettirmek için konulduğuna %99,99 eminim noktasız versiyon değeri geri dönüyor, devaaam</p>
<h2 id="sub_401390">sub_401390<a href="#sub_401390" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_401390.JPG" alt="sub_401390">
Yine zamanım çalınıcak gibi hissediyorum ama x64dbg geçtik yine</p>
<h2 id="sub_401390-dinamik-analiz">sub_401390 Dinamik Analiz<a href="#sub_401390-dinamik-analiz" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>
 
<video width=100% controls>
    <source src="images/sub_401390.mp4" type="video/mp4">
    Your browser does not support the video tag.  
</video>

Ömrümü yediğim şeye bak amk yine versiyon döndürdü neyse devam ediyoruz</p>
<h2 id="sub_40123e">sub_40123E<a href="#sub_40123e" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_40123E.JPG" alt="sub_40123E"></p>
<p>Bak bu ilginçmiş işte C diskinin seri numarasını çekip SN ile başlayan bir yazıya seri numarası ve uygulama versiyonunu içeren bir dizi bit işlemine sokuyor ve değer ValuName isimli değişkene atanıyor. Bu kısım büyük ihtimal direkt Http Debugger analiz edilerek bulundu, bizi sinir krizine girmek zorunda bırakmadıkları için teşekkür ediyor ve devam ediyoruz</p>
<h2 id="sub_4011c1">sub_4011C1<a href="#sub_4011c1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_4011C1.JPG" alt="sub_4011C1"></p>
<p>Sonunda lisans üretimine gelebildik çok da fantazili bişeyler yokmuş hayal kırıklığına uğramadım desem yalan olur :D</p>
<p>3 adet 0 ile 254 arası sayı üretiliyor ve değişik bit işlemlerinin değerleri hex olarak Data isimli değişkene atanıyor</p>
<h2 id="sub_4012d4">sub_4012D4<a href="#sub_4012d4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="images/sub_4012D4.JPG" alt="sub_4012D4"></p>
<p>Burada ValueName kayıt defterinde isim Data ise onun değeri olarak kullanılarak kayıt defterine yazılıyor</p>
<h2 id="sondaki-küçük-kod-parçacığı">Sondaki Küçük Kod Parçacığı<a href="#sondaki-küçük-kod-parçacığı" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>v6 <span style="color:#f92672">=</span> __rdtsc();
</span></span><span style="display:flex;"><span>srand(HIDWORD(v6) <span style="color:#f92672">^</span> v6);
</span></span></code></pre></div><p>Bunun sayesinde iki satırda iki farklı şey öğrendim;</p>
<ul>
<li>__rdtsc fonksiyonu Windows makinelerde rtdsc assembly komutununu üretmeye yarıyormuş bu ise son yeniden başlatmadan sonra geçen işlemci döngü sayısını veriyormuş</li>
<li>HIDWORD makrosu bir DWORD&rsquo;ün son 2 baytını getirmeye yarıyormuş</li>
</ul>
<p>Yani bu kod parçası rastgele olma olasılığı çok yüksek olan bir değeri alıp bu değeri son 2 baytı ile XOR işlemine sokup gelen veriyi rastgele sayı üreticiye &ldquo;seed&rdquo; olarak kullanıyor. time(NULL) kullanan eziklere duyurulur :D</p>
<h2 id="çıkış">Çıkış<a href="#çıkış" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Şimdilik bu kadar bölüm ikide burdan öğrendiklerimizi kullanarak Rust ile baştan keygen yazmaya çalışıcaz</p>
<p>Bu arada temizlenilmiş IDB dosyası için: <a href="https://cloud.disroot.org/s/cMR8J3FTzaxqcMJ">https://cloud.disroot.org/s/cMR8J3FTzaxqcMJ</a></p>

      </div></div>

  

  
  <script src="https://utteranc.es/client.js"
        repo="usdogu/usdogu.github.io"
        issue-term="pathname"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>
  
</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2022 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://usdogu.github.io/assets/main.js"></script>
<script src="https://usdogu.github.io/assets/prism.js"></script>




<script data-goatcounter="https://usdogu.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

  
</div>

</body>
</html>
